---
layout: page
title: Konfirmasi Pesanan
permalink: /konfirmasi
---
    <ion-content class="ion-no-padding">
      <div class="container" id="order-container" style="margin-top:66px;"></div>
    </ion-content>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const params = new URLSearchParams(window.location.search);
      const orderId = params.get("orderId");

      if (!orderId) {
        document.getElementById("order-container").innerHTML = `
          <ion-card color="danger">
            <ion-card-header>
              <ion-card-title>Gagal</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              Order ID tidak ditemukan.
            </ion-card-content>
          </ion-card>`;
        return;
      }

      firebase.auth().onAuthStateChanged(async (user) => {
        if (!user) {
          document.getElementById("order-container").innerHTML = `
            <ion-card color="warning">
              <ion-card-header>
                <ion-card-title>Autentikasi</ion-card-title>
              </ion-card-header>
              <ion-card-content>
                Silakan login untuk melihat konfirmasi pesanan.
              </ion-card-content>
            </ion-card>`;
          return;
        }

        const db = firebase.firestore();
        const orderRef = db.collection("users").doc(user.uid).collection("orders").doc(orderId);
        const orderSnap = await orderRef.get();
		
// ðŸš« Cek status order gagal
if (!orderSnap.exists) {
  document.getElementById("order-container").innerHTML = `
    <ion-card color="danger">
      <ion-card-header>
        <ion-card-title>Gagal</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        Order tidak ditemukan atau bukan milik Anda.
      </ion-card-content>
    </ion-card>`;
  return;
}

const data = orderSnap.data();

// ðŸš« Cek status order belum bayar
if (data.status !== "paid") {
  document.getElementById("order-container").innerHTML = `
    <ion-card color="warning">
      <ion-card-header>
        <ion-card-title>Menunggu Pembayaran</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        Pesanan ini belum dibayar. Silakan selesaikan pembayaran terlebih dahulu.
      </ion-card-content>
    </ion-card>`;
  return;
}

// âœ… Kalau status sudah "paid", tampilkan detail pesanan
const itemList = data.items.map(item =>
  `<ion-item>
     <ion-label>
       <h2>${item.name}</h2>
       <p>Jumlah: ${item.quantity}</p>
     </ion-label>
  </ion-item>`
).join("");

// render isi pesanan ke halaman
document.getElementById("order-container").innerHTML = `
  <ion-card>
    <ion-card-header>
      <ion-card-title>Terima kasih, ${data.email}!</ion-card-title>
      <ion-card-subtitle>Order ID: ${orderId}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Total:</strong> Rp${data.total.toLocaleString()}</p>
	  <p><strong>Reward:</strong> ${data.reward?.coins || 0} coins (${data.reward?.level || '-'})</p>

      <ion-list>${itemList}</ion-list>
    </ion-card-content>
  </ion-card>`;
      });
    });
  </script>